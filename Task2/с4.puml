@startuml
!include <C4/C4_Container>

title Система "Медикаменте" (MVP) с Data Privacy\nТребования: Конфиденциальность (ФЗ-152), масштабируемость, автоматизация

Person(patient, "Пациент", "Регистрация, запись через портал")
Person(doctor, "Врач", "Доступ к медкартам")
Person(reception, "Ресепшен", "Управление записями")

System_Boundary(medikamente, "Ядро системы") {
  Container(portal, "Клиентский портал", "React", "Хранение: Сессии в Redis\nЗащита: HTTPS + JWT")
  Container(api, "API Gateway", "Kong", "Аутентификация: OAuth 2.0\nAudit: Логи в ELK")
  Container(db, "База данных", "PostgreSQL", "Шифрование: AES-256 (PII)\nУдаление: Через 5 лет (ФЗ-152)")
  Container(payment, "Платёжный шлюз", "1С + Тинькофф API", "Стандарт: PCI DSS")
  Container(lab, "Интеграция с лабораторией", "REST API", "Защита: mTLS\nДанные: Только свои анализы")
}

Rel(patient, portal, "1. HTTPS + JWT (ФИО, телефон)", "HTTPS")
Rel(portal, api, "2. TLS 1.3 (запросы)", "TLS")
Rel(api, db, "3. Шифрование полей (PII)", "AES-256")
Rel(db, doctor, "4. ABAC (доступ только к своим пациентам)", "ABAC")
Rel(api, lab, "5. mTLS + теги DLP (направления/анализы)", "mTLS")
Rel(api, payment, "6. Токенизация карт (PCI DSS)", "PCI")
Rel(reception, portal, "7. RBAC (роли: запись/отмена)", "RBAC")

legend right
  <b>Меры Data Privacy:</b>
  ====
  <color:#0000FF>Шифрование:  AES-256 (БД), TLS 1.3 (трафик)</color>
  <color:#006400>Контроль доступа: RBAC (роли) + ABAC (атрибуты)</color>
  <color:#8B0000>Сроки хранения: 5 лет для PII (ФЗ-152)</color>
  <color:#FF8C00>Тегирование: DLP для CONFIDENTIAL</color>
endlegend
@enduml